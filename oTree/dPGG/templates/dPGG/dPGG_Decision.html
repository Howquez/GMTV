{% extends "global/Page.html" %}
{% load otree static %}

{% block styles %}
    <link href="{% static 'global/css/global.css' %}" rel="stylesheet">
{% endblock %}


{% block scripts %}
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<script src="{% static 'global/js/basics.js' %}"></script>
{% if player.round_number > 1%}
<script src="{% static 'global/js/time_series.js' %}"></script>
{% endif %}
<script src="{% static 'global/js/decision.js' %}"></script>
<script src="{% static 'global/js/instructions_clicks.js' %}"></script>
{% endblock %}

{% block content %}
<body onload="">
<img src="{% static 'global/images/cool-background.svg' %}" id="bg" alt=""/>


<!-- Header -->
<nav class="navbar sticky-top bg-header border-bottom mb-4 justify-content-between">
    {% if player.round_number == last_round %}
    <span class="badge badge-secondary" data-toggle="tooltip" data-placement="bottom" title="Sie befinden sich in der {{ player.round_number }}. Runde">
        Letzte Runde
    </span>
    {% else %}
    <span class="badge badge-secondary" data-toggle="tooltip" data-placement="bottom" title="Sie befinden sich in der {{ player.round_number }}. Runde">
        Runde {{ player.round_number }}
    </span>
    {% endif %}
    <div style="cursor: pointer;">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#666666" class="bi bi-book-fill" viewBox="0 0 16 16"
        data-toggle="modal" data-target="#instructionsModal" id="instructions_icon">
            <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/>
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#666666" class="bi bi-headset" viewBox="0 0 16 16" data-toggle="modal" data-target="#contactModal" id="contact_icon">
            <path d="M8 1a5 5 0 0 0-5 5v1h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V6a6 6 0 1 1 12 0v6a2.5 2.5 0 0 1-2.5 2.5H9.366a1 1 0 0 1-.866.5h-1a1 1 0 1 1 0-2h1a1 1 0 0 1 .866.5H11.5A1.5 1.5 0 0 0 13 12h-1a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h1V6a5 5 0 0 0-5-5z"/>
        </svg>
    </div>
</nav>


<!-- Hidden tracking Fields -->
<input type="hidden" name="review_instructions" id="id_review_instructions" value="0"/>
<input type="hidden" name="review_contact" id="id_review_contact" value="0"/>


<!-- timeout Alert -->
<div class="alert alert-danger alert-dismissible fade" id="timeoutModal" role="alert">
    <strong>Bitte fällen Sie eine Entscheidung.</strong> Für Ihre Eingabe in dieser Runde verbleiben Ihnen nur noch
    30 Sekunden.
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>

<!-- Decision Card -->
<div class="container">
    <div class="row justify-content-center">
        <div class="col-sm-12 col-md-10 col-lg-8">

            <div class="card mt-5">
                <div class="card-body">

                    <h5 class="card-title display-3 mb-1" data-toggle="tooltip" data-placement="top" title="Ihr aktueller Kontostand">
                        {{ player.endowment }}
                        <small class="text-muted">
                            Punkte
                        </small>
                    </h5>
                    <h6 class="card-subtitle mb-4">
                        {% if player.round_number > 1%}
                            {% if diff >= 0 %}
                                <span class="badge badge-success" data-toggle="tooltip" data-placement="right" title="Punkte, die sie in der letzten Runde dazuverdient haben">
                                    +{{ diff }} Punkte
                                </span>
                            {% else %}
                                <span class="badge badge-danger" data-toggle="tooltip" data-placement="right" title="Punkte, die sie in der letzten Runde verloren haben">
                                    {{ diff }} Punkte
                                </span>
                            {% endif %}
                        {% endif %}
                    </h6>

                    <hr class="my-4">

                    {% if bot_active %}
                        <div class="alert alert-danger mb-4 mt-4 alert-dismissible fade show" role="alert">
                            Leider ist ein Mitglied aus Ihrer Gruppe ausgeschieden. Ein Computerprogramm wird zufällige
                            Entscheidungen für ausgeschiedene Gruppenmitglied fällen.

                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                    {% endif %}

                    {% if EWE %}
                        <div class="alert alert-success mb-4 mt-4 alert-dismissible fade show" role="alert">
                            Es ist ein Extremwetterereignis eingetreten. Dieses hatte aber keine Auswirkungen auf
                            das Guthaben von Ihnen oder den übrigen Gruppenmitgliedern.

                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                    {% endif %}

                    <p class="card-text lead mb-1">
                        Von diesen {{ player.endowment }} Punkten können Sie einen beliebigen Betrag zum Gruppenprojekt
                        beitragen.
                    </p>

                    <p class="mb-4">
                        <small>
                            Zurückgelegte, also nicht zum Gruppenprojekt beigetragene, (Rest-) Beträge  stehen Ihnen in
                            der nächsten Runde unverändert zur Verfügung.
                        </small>
                    </p>

                    <div class="form-group row mb-4">
                        <div class="col">
                            <input type="number" class="form-control float-right" placeholder="Beitragen" id="id_contribution" name="contribution" min="0" required
                                   data-container="body" data-toggle="popover" data-placement="bottom" data-content="Sie können in dieser Runde maximal {{ player.endowment }} Punkte beitragen.">
                        </div>
                        <div class="col">
                            <button type="button" id="submit_button" class="btn-outline-primary btn float-left" onclick="submitForm();">
                                Alles zurücklegen
                            </button>
                        </div>
                    </div>

                </div>

                {% if player.round_number > 1%}
                <div class="card-footer bg-light text-secondary">

                    <p class="lead mb-1">Ihr Guthaben:</p>

                    <figure class="highcharts-figure mb-1">
                        <div id="container"></div>
                    </figure>

                    <p class="mb-1"><small>Die Grafik stellt Ihnen die Entwicklung Ihres Punktestands im Zeitverlauf dar.</small></p>


                    <p class="lead mt-5 mb-1">Entscheidungen der Vorrunde:</p>

                    <table class="table table-hover table-responsive-md">
                        <thead>
                        <td>Teilnehmer</td>
                        <td>Voriges Guthaben</td>
                        <td>Beitrag</td>
                        <td>Dividende</td>
                        <td>Aktuelles Guthaben</td>
                        </thead>
                        {% for t in player.in_all_rounds %}
                            {% if t.round_number == previous_round %}
                                <tr>
                                    <td><small> <span class="badge badge-secondary">Sie</span> </small></td>
                                    <td class="text-center"><small> {{ t.endowment }} </small></td>
                                    <td class="text-center"><small> {{ t.contribution }} </small></td>
                                    <td class="text-center"><small> {{ t.group.individual_share }} </small></td>
                                    <td class="text-center" data-toggle="tooltip" data-placement="top" title="={{ t.endowment }}-{{ t.contribution }}+{{ t.group.individual_share }}"><small> {{ t.stock }} </small></td>
                                </tr>
                                {% for p in t.get_others_in_group %}
                                    <tr>
                                        <td><small> <span class="badge badge-light"> #{{ p.id_in_group }}</span> </small></td>
                                        <td class="text-center"><small> {{ p.endowment }} </small></td>
                                        <td class="text-center"><small> {{ p.contribution }} </small></td>
                                        <td class="text-center"><small> {{ p.group.individual_share }} </small></td>
                                        <td class="text-center" data-toggle="tooltip" data-placement="top" title="={{ p.endowment }}-{{ p.contribution }}+{{ p.group.individual_share }}"><small> {{ p.stock }} </small></td>
                                    </tr>
                                {% endfor %}
                            {% endif %}
                        {% endfor %}
                    </table>

                    <p class="mb-3">
                        <small>
                            Die Tabelle zeigt Ihnen das Guthaben von Ihnen und den übrigen Gruppenmitgliedern zu Beginn
                            der letzten Runde (ganz links) sowie das aktuelle Guthaben zu Beginn dieser Runde (ganz
                            rechts). Das aktuelle Guthaben ergibt sich dabei wie folgt:
                        </small>
                    </p>
                    <p class="text-center">
                        <small>
                            Voriges Guthaben - Beitrag + Dividende = Aktuelles Guthaben
                        </small>
                    </p>

                </div>

                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Contact Modal -->
<div class="modal fade bd-modal-lg" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="contactModalTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <p class="lead">
                    Bitte rufen Sie im Falle von technischen Problemen oder Fragen unsere Service-Hotline an:
                </p>
                <address>
                    WiSo-Forschungslabor <br>
                    Fakultät für Wirtschafts- und Sozialwissenschaften<br>
                    Universität Hamburg <br>
                    Von-Melle-Park 5 <br>
                    Raum 2155/56 <br>
                    20144 Hamburg <br><br>
                    <a href="mailto:experiments.wiso@uni-hamburg.de?subject=CLICCS B5 Studie">experiments.wiso@uni-hamburg.de</a><br>
                    <a href="tel:+4940428389334">+49 40 42 838 - 9334</a>
                </address>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Schließen</button>
            </div>
        </div>
    </div>
</div>

<!-- Instructions Modal -->
    <div class="modal fade bd-example-modal-lg" id="instructionsModal" tabindex="-1" role="dialog" aria-labelledby="instructionsModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <!-- Card's Tab Navigation -->
                    <ul class="nav nav-tabs card-header-tabs" id="myTab" role="tablist">

                        <li class="nav-item" >
                            <a class="nav-link back-and-forth active" id="part1-tab" data-toggle="tab" href="#part1" role="tab" aria-controls="part1"> Allgemeines </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link back-and-forth" id="part2-tab" data-toggle="tab" href="#part2" role="tab" aria-controls="part2"> Aufbau </a>
                        </li>


                    </ul>
                </div>
                <div class="modal-body">
                    <div class="tab-content" id="myTabContent">

                        <!-- Part 1: Allgemeines -->
                        <div class="tab-pane show active" id="part1" role="tabpanel" aria-labelledby="part1-tab">
                            <div class="card-body">
                                <h5>
                                    <span class="badge badge-content mt-4">
                                        Inhalt
                                    </span>
                                </h5>
                                <p>
                                    Sie nehmen jetzt an einer Studie der Hamburger Universitäten teil. Wenn Sie die Instruktionen aufmerksam
                                    lesen und befolgen, können Sie einen beträchtlichen Betrag verdienen, der von Ihren
                                    Entscheidungen und den Entscheidungen weiterer Teilnehmer_innen abhängt. Dieser Betrag wird Ihnen am
                                    Ende des Studie genannt und ausgezahlt.
                                </p>

                                <h5>
                                    <span class="badge badge-content mt-4">
                                        Wechselkurs
                                    </span>
                                </h5>
                                <p>
                                    Während der gesamten Studie werden Sie Entscheidungen über Punkte fällen. Am Ende des
                                    Studie werden alle Punkte zu einem Wechselkurs von 5 Cent je Punkt umgerechnet. Zusätzlich
                                    erhalten sie eine Pünktlichkeitsprämie in Höhe von {{ session.config.participation_fee }}.
                                </p>

                                <h5>
                                    <span class="badge badge-content mt-4">
                                        Disqualifikation
                                    </span>
                                </h5>
                                <p>
                                    Es ist wichtig, dass Sie konzentriert und ohne Unterbrechungen an der Studie teilnehmen.
                                    Sollten Sie die Studie frühzeitig abbrechen oder länger als 3 Minuten keine Entscheidung treffen,
                                    dann können wir Ihre Daten sowie die Daten Ihrer Gruppenmitglieder nicht auswerten. Deshalb
                                    können wir Ihnen nur dann Geld auszahlen, wenn Sie ans Ende der Studie gelangen.
                                </p>

                            </div>
                        </div>


                        <!-- Part 2: Aufbau  -->
                        <div class="tab-pane" id="part2" role="tabpanel" aria-labelledby="part2-tab">
                            <div class="card-body">
                                <h5>
                                    <span class="badge badge-content mt-4">
                                        Runden & Gruppen
                                    </span>
                                </h5>
                                <p>
                                    Die Studie besteht aus {{ session.config.num_rounds }} Entscheidungsrunden.
                                    Zu Beginn der Studie werden Sie mit {{ Constants.num_others_per_group }} weiteren
                                    Teilnehmern_innen gruppiert. In einer Gruppe sind daher {{ Constants.players_per_group }} Personen, inklusive
                                    Ihnen. Die Zusammensetzung der Gruppe wird sich für die Dauer der Studie nicht verändern.
                                    Weil die Studie anonym ist, kennen Sie Ihre Gruppenmitglieder nicht und Ihre
                                    Gruppenmitglieder kennen Sie nicht.
                                </p>

                                <h5>
                                    <span class="badge badge-content mt-4">
                                        Startguthaben
                                    </span>
                                </h5>
                                <p>
                                    Vor der ersten Runde bekommen Sie ein Guthaben von 20 Punkten.
                                </p>

                                <h5>
                                    <span class="badge badge-content mt-4">
                                        Entscheidungen
                                    </span>
                                </h5>
                                <p>
                                    Zu Beginn der ersten Runde werden Sie gebeten, Ihr Guthaben entweder zu einem Gruppenprojekt
                                    beizutragen oder es zurückzulegen. Punkte, die Sie zurücklegen, haben keinen Ertrag.
                                    Zurückgelegte Punkte werden also einfach behalten und stehen Ihnen zu Beginn der nächsten Runde
                                    unverändert zur Verfügung. Niemand außer Ihnen profitiert von Ihren zurückgelegten Punkten.
                                    <br><br>
                                    Die Punkte, die Sie zu dem Gruppenprojekt beitragen, werden zu den Beiträgen der anderen
                                    {{ Constants.num_others_per_group }} Gruppenmitglieder gerechnet. Die Summe der Beiträge
                                    hat einen Ertrag von {{ Constants.efficiency_factor }} (also eine Rendite von
                                    {{ Constants.rate_of_return }}%) und wird anschließend in Form einer Dividende gleichmäßig auf
                                    alle Gruppenmitglieder aufgeteilt. Dementsprechend profitieren alle Gruppenmitglieder
                                    gleichermaßen von den Beiträgen und der Rendite. Das heißt, dass die Summe
                                    aller Beiträge einer Runde zusammengezählt und dann mit {{ Constants.efficiency_factor }}
                                    multipliziert wird, bevor sie
                                    zu gleichen Teilen auf alle Gruppenmitglieder aufgeteilt wird.
                                    Dementsprechend ist Ihre Dividende am Ende der ersten Runde die folgende:
                                </p>
                                $$\frac{\text{Beitragssumme} \times {{ Constants.efficiency_factor }} }{ {{ Constants.players_per_group }} }$$


                                <h5>
                                    <span class="badge badge-content mt-4">
                                        Erträge
                                    </span>
                                </h5>
                                <p>
                                    Ihr Guthaben zu Beginn der zweiten Runde entspricht Ihren zurückgelegten Punkten sowie Ihrer
                                    Dividende aus der ersten Runde.

                                    Zu Beginn der zweiten Runde werden Sie dann wieder gefragt, wie viele Punkte Sie zurücklegen und
                                    wie viele Punkte Sie beitragen wollen. Zurückgelegte und beigetragene Punkte funktionieren dabei exakt
                                    genauso wie in der ersten Runde auch: Zurückgelegte Punkte werden bis zur Folgerunde unverändert behalten
                                    und das Ergebnis der Beiträge wird in Form einer Dividende auf alle Gruppenmitglieder
                                    ausgezahlt.

                                    Alle weiteren Runden folgen derselben Struktur: Ihr Guthaben zu Beginn einer Runde entspricht
                                    den zurückgelegten Punkten und der Dividende der Vorrunde.
                                </p>

                                <h5>
                                    <span class="badge badge-content mt-4">
                                        Informationen
                                    </span>
                                </h5>
                                <p>
                                    In jeder Runde werden Sie über Folgendes informiert:
                                </p>
                                <ul>
                                    <li>Das Guthaben der jeweiligen Gruppenmitglieder zu Beginn der Vorrunde</li>
                                    <li>Die Beiträge der jeweiligen Gruppenmitglieder in der Vorrunde</li>
                                    <li>Die Dividende in der Vorrunde</li>
                                    <li>Das Guthaben der jeweiligen Gruppenmitglieder zu Beginn der aktuellen Runde</li>
                                </ul>
                                <p>
                                    Alle weiteren Gruppenmitglieder erhalten exakt die gleichen Instruktionen wie Sie.
                                </p>


                                <h5>
                                    <span class="badge badge-content mt-4">
                                        Verdienst
                                    </span>
                                </h5>
                                <p>
                                    Am Ende der Studie bekommen Sie einen Verdienst, der sich, wenn Sie alle Runden durchlaufen und
                                    alle Fragen beantortet haben, aus den folgenden Bestandteilen
                                    zusammensetzt: Zum einen bekommen Sie die Pünktlichkeitsprämie in Höhe von
                                    {{ session.config.participation_fee }}.

                                    {% if session.config.belief_elicitation %}
                                    Darüber hinaus bekommen Sie einen Verdienst aus der
                                    Schätzaufgabe sowie das Guthaben, das Sie am Ende der {{ session.config.num_rounds }}ten
                                    (also am Ende der letzten) Runde haben.
                                    {% else %}
                                    Darüber hinaus bekommen Sie das Guthaben, das Sie am Ende der {{ session.config.num_rounds }}ten
                                    (also am Ende der letzten) Runde haben.
                                    {% endif %}
                                    <strong>
                                        Dementsprechend ist ihr Verdienst umso höher, je mehr Guthaben Sie zum Ende der letzten Runde
                                        haben.
                                    </strong>
                                    Zusätzlich bekommen Sie den Verdienst aus der Risikoabwägung.
                                </p>

                                <h5>
                                    <span class="badge badge-content mt-4">
                                        Inaktivität
                                    </span>
                                </h5>
                                <p>
                                    In der ersten Runde haben Sie 10 Minuten Zeit, um Ihre Entscheidungen zu fällen. In allen
                                    folgenden Runden haben Sie maximal vier Minuten. 30 Sekunden vor Ablauf der jeweiligen Frist,
                                    weisen wir Sie auf die Zeit hin.
                                </p>
                                <p>
                                    Diese Fristen sind notwendig, damit Ihre Gruppenmitglieder nicht zu lange auf Ihre
                                    Entscheidungen warten müssen. Sollten Sie länger als 4 bzw. 10 Minuten inaktiv sein, werden
                                    Sie von der Studie ausgeschlossen und durch einen Bot ersetzt, der Entscheidungen für Sie trifft,
                                    damit Ihre Gruppenmitglieder fortfahren können. Diese werden dann darüber benachrichtigt, dass
                                    Sie durch einen Bot ersetzt wurden.
                                </p>
                                <p>
                                    Wie oben bereits erwähnt, können wir Ihre Daten nicht verwenden, dann Sie aufgrund von
                                    Inaktivität von der Studie ausgeschlossen werden. Deshalb können wir Ihnen in dem Fall kein Geld
                                    auszahlen.
                                </p>

                            </div>
                        </div>


                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Schließen</button>
                </div>
            </div>
        </div>
    </div>

</body>
{% endblock %}


