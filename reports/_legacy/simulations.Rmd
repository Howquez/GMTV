---
title: "Visualize Simulations"
description: |
  Using GÃ¤chter et al.'s Graphs
author:
  - name: Hauke Roggenkamp 
    affiliation: CLICCS
    affiliation_url: https://www.cliccs.uni-hamburg.de/
date: "`r Sys.Date()`"
bibliography: biblio.bib
output:
  distill::distill_article:
    toc: true
    toc_depth: 2
    toc_float: false
    code_folding: true
---

This document attaches the simulated data to @GACHTER2017's data and reproduces their key visualizations.

```{r setup, include=TRUE}
knitr::opts_chunk$set(echo = FALSE)

library(data.table)
library(tidyverse)
library(kableExtra)

library(Rmisc)
library(wesanderson)

base::load(file = "../data/processed/simulations.rda") 
base::load(file = "../data/processed/gaechter2017.rda") 

```

# Data

The resulting data looks as follows. Each row represents a group, not a player. The displayed ```treatment``` names reflect the risk of extreme weather events as well as the share of current endowments contributed. ```Hi033``` indicates that the simulated subjects contributed a relatively high share of endowments facing a risk of 33 percent. In contrast, ```Lo000``` was parameterized such that there were no extreme weather events and contributions were relatively low. ```noPunish10``` represents @GACHTER2017's data from the no punish treatment with ten rounds. 

The ```contribution``` shows a group's average contribution and the ```endowment``` their average endowment at the beginning of a round. The reported ```share``` is the fraction of both. ```stock``` is the group's average income at the end of the round and gain lists the difference between the ```stock``` and ```endowment```.

```{r combineData}
combined <- rbindlist(list(longDT, gaechter))

combined %>%
  head(n = 9) %>%
  kbl() %>% 
  # scroll_box(height = "200px") %>%
  kable_paper("hover", 
              full_width = TRUE,
              fixed_thead = TRUE)
```


```{r vizSetup, include = FALSE}
layout <- theme(panel.background = element_rect(fill = "white"),
                panel.grid = element_line(colour="gray", size=0),
                panel.grid.major.y = element_line(colour="gray", size=0.25),
                legend.key = element_rect(fill = "white"),
                axis.line.x.bottom = element_line(size = 0.25),
                axis.line.y.left = element_line(size = 0.25),
                plot.margin = unit(c(1,1,1,1), "cm"),
                legend.title = element_blank()
                )
```

# Visualization

The following graph shows that both ```Hi``` -treatments were parameterized similarly. The same applies to the two ```Lo``` -treatments. The original ```noPunish10``` data lies between both sets of simulations. The horizontal dashed line represents the threshold required for damage control.

```{r plotShare}
plotDT <- summarySE(data = combined, 
                      measurevar = "share", 
                      groupvars=c("treatment", "round"),
                      na.rm = FALSE,
                      conf.interval = 0.95,
                      .drop = TRUE)
  
temp <- plotDT[, "share"]

# plot
ggplot(data = plotDT, aes(x = round, y = temp, fill = treatment, color = treatment)) + 
    layout +
    geom_hline(yintercept = 0.5, color = "#666666", lty = 2) +
    scale_fill_manual(values = wes_palette("Zissou1")) +
    scale_color_manual(values = wes_palette("Zissou1")) +
    geom_errorbar(aes(ymin=temp-ci, ymax=temp+ci), width=.25, alpha = 0.5) +
    geom_line() +
    geom_point() + 
    scale_x_continuous(name="Period",  breaks = 1:15) +
    scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
    labs(y = "Share of Current Endowment contributed")
```

The different shares of contributions result in very different absolute contributions. The following graph illustrates the resulting heterogeneity between treatments. Combining this and the previous graph, it becomes clear that the ```033``` treatments lead to lower absolute contributions because of extreme weather events that occurred: The two blue lines (representing the ```Hi```-treatments) follow the same direction until the share of contributions falls short of the 50% benchmark in period 5 that makes damaged possible. From there on, damages reduce contributions in the ```Hi033```-treatment but not in the ```Hi000``` (where extreme weather events and thus, damages don't occur.)

```{r plotContribution}
plotDT <- summarySE(data = combined, 
                      measurevar = "contribution", 
                      groupvars=c("treatment", "round"),
                      na.rm = FALSE,
                      conf.interval = 0.95,
                      .drop = TRUE)
  
temp <- plotDT[, "contribution"]

# plot
ggplot(data = plotDT, aes(x = round, y = temp, fill = treatment, color = treatment)) + 
    layout +
    geom_vline(xintercept = 5, color = "#666666", lty = 2) +
    scale_fill_manual(values = wes_palette("Zissou1")) +
    scale_color_manual(values = wes_palette("Zissou1")) +
    geom_errorbar(aes(ymin=temp-ci, ymax=temp+ci), width=.25, alpha = 0.5) +
    geom_line() +
    geom_point() + 
    scale_x_continuous(name="Period",  breaks = 1:15) +
    scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
    labs(y = "Average Amount of Points contributed")
```

One finds the same pattern in ```Wealth``` levels:

```{r plotStock}
plotDT <- summarySE(data = combined, 
                      measurevar = "stock", 
                      groupvars=c("treatment", "round"),
                      na.rm = FALSE,
                      conf.interval = 0.95,
                      .drop = TRUE)
  
temp <- plotDT[, "stock"]

# plot
ggplot(data = plotDT, aes(x = round, y = temp, fill = treatment, color = treatment)) + 
    layout +
    scale_fill_manual(values = wes_palette("Zissou1")) +
    scale_color_manual(values = wes_palette("Zissou1")) +
    geom_errorbar(aes(ymin=temp-ci, ymax=temp+ci), width=.25, alpha = 0.5) +
    geom_line() +
    geom_point() + 
    scale_x_continuous(name="Period",  breaks = 1:15) +
    scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
    labs(y = "Wealth")
```
